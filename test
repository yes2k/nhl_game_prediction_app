---
title: "Untitled"
format: html
---


```{python}
import cmdstanpy
import polars as pl
# from src.create_model import get_model_data
```



```{python}
result = get_model_data("data", "2023", "2024-02-01")

datalist = {
    "N": result["model_df"].shape[0],
    "n_teams": result["team_id_map"].shape[0],
    "home_teams": result["model_df"]["home_id"].to_numpy(),
    "away_teams": result["model_df"]["away_id"].to_numpy(),
    "home_goals": result["model_df"]["home_goals"].to_numpy(),
    "away_goals": result["model_df"]["away_goals"].to_numpy(),
    "home_new": result["team_id_map"].filter(pl.col("team") == "TOR")["id"].to_numpy(),
    "away_new": result["team_id_map"].filter(pl.col("team") == "BOS")["id"].to_numpy(),
    "N_new": 1
}

model = cmdstanpy.CmdStanModel(stan_file = "src/model/model.stan")
model_fit = model.sample(datalist, parallel_chains=4)
# model_fit = model.sample(datalist, show_console=True)
```





```{python}
home_new_draw = model_fit.stan_variable("home_new")
away_new_draw = model_fit.stan_variable("away_new")

draws_df = pl.DataFrame({
    "home_new_draw": home_new_draw,
    "away_new_draw": away_new_draw
})

```